<template>
  <div ref="svgContainer" class="full-fill" style="display:flex;position:relative;" onselectstart="return false">
    <img ref="img" class="full-fill" width="100%" height="100%" :src="imgSrc" style="background:#eee">
    <svg ref="svg" width="100%" height="100%" class="full-fill"/>
  </div>
</template>

<script>
import SVG from 'svg.js';
import 'svg.select.js';
import 'svg.resize.js';
import 'svg.draggable.js';
import Handler from './handler';

export default {
  data () {
    return {
      draw: SVG(),
    };
  },
  props: {
    imgSrc: { type: String, default: '' },
    options: { type: Object, default: function () { return {} } }
  },
  watch: {
    options: function (newValue, oldValue) {
      console.log(newValue, 'newValue')
      if (this.$refs.svgContainer)
        Handler.register(this, this.$refs.svgContainer, this.draw, newValue);
    },
  },
  mounted() {
    this.draw = SVG.adopt(this.$refs.svg);
  },
  methods: {
    setData(data) {
      if (JSON.stringify(this.getData()) === JSON.stringify(data)) return;
      this.draw.clear();
      data = JSON.parse(JSON.stringify(data));
      data.forEach(d => {
        if (Handler[d.type]) Handler[d.type].drawObj(this.draw, d);
      });
    },

    getData() {
      return this.draw.children().filter(e => e.data('egp')).map(d => d.data('egp'));
    },

  },
}
</script>

<style lang="scss" scoped>
.full-fill {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
</style>
