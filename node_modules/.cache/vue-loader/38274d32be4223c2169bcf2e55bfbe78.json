{"remainingRequest":"D:\\work\\workSpace\\upload\\picture-detection-window\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workSpace\\upload\\picture-detection-window\\src\\views\\pictureDetection\\Main.vue?vue&type=style&index=0&id=7071b35e&lang=scss&scoped=true&","dependencies":[{"path":"D:\\work\\workSpace\\upload\\picture-detection-window\\src\\views\\pictureDetection\\Main.vue","mtime":1563864739715},{"path":"D:\\work\\workSpace\\upload\\picture-detection-window\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\work\\workSpace\\upload\\picture-detection-window\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\work\\workSpace\\upload\\picture-detection-window\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\work\\workSpace\\upload\\picture-detection-window\\node_modules\\sass-loader\\lib\\loader.js","mtime":1533139052000},{"path":"D:\\work\\workSpace\\upload\\picture-detection-window\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\workSpace\\upload\\picture-detection-window\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.pic{\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: white;\n}\nh4{\n  text-align: right;\n}\n .avatar-uploader .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n  }\n  .avatar-uploader .el-upload:hover {\n    border-color: #409EFF;\n  }\n  .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 178px;\n    height: 178px;\n    line-height: 178px;\n    text-align: center;\n  }\n  .avatar {\n    width: 178px;\n    height: 178px;\n    display: block;\n  }\n\n",{"version":3,"sources":["Main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Main.vue","sourceRoot":"src/views/pictureDetection","sourcesContent":["<template>\n  <div class=\"pic\" v-loading=\"loading\" element-loading-text=\"视频分析中\" element-loading-spinner=\"el-icon-loading\">\n    <div style=\"background:white;\">\n      <div style=\"border-left: 10px solid #67C23A;padding:10px;margin:10px;font-size:14px;border-bottom:1px solid #ccc;\">\n        视频分析\n      </div>\n    </div>\n    <div style=\"flex:1;display:flex; flex-direction: column;padding-left: 30px;\">\n       <div style=\"margin-bottom:20px;display:flex;width: 300px;align-items: center;\">\n          <div style=\"font-weight: bold;font-size: 16px;\">操作按钮：</div>\n          <div style=\"display:flex;justify-content: flex-end;margin-left:20px;\">\n            <el-button :loading=\"uploadLoding\" size=\"small\" \n            :type=\"uploadBtn\" @click=\"submitUpload\">上传并检测</el-button>\n            <el-button :loading=\"uploadLoding\" size=\"small\" \n            type=\"danger\" @click=\"clearAll\">清空</el-button>\n            </div>\n       </div>\n       <el-upload ref=\"upload\" class=\"avatar-uploader\" action=\"https://jsonplaceholder.typicode.com/posts/\" \n       :show-file-list=\"false\" :auto-upload=\"false\" style=\"width: 300px;height:200px;\">\n        <i style=\"border: 1px dashed #d9d9d9;color:#85ce61; font-size:80px;width: 300px;height:200px;border-radius:10px;\" class=\"avatar-uploader-icon el-icon-upload\"></i>\n      </el-upload>\n      <div style=\"width:100%;border-bottom: 1px solid #ccc;margin-top:10px;margin-bottom:10px;\"></div>\n      <div v-if=\"resultList.length\" style=\"display:flex;margin-top:30px;\" @click=\"showResult\">\n        <div v-for=\"(item, index) in resultList[0].result\" :key=\"index\" \n        style=\"display:flex; flex-direction: column;padding:5px;\">\n           <div style=\"width: 150px; height: 150px;\">\n              <img style=\"width:100%; height:100%;\" :src=\"item.url\" alt=\"\">\n           </div>\n           <div style=\"display:flex;\">\n             <div style=\"font-weight: bold;\">图片名字：</div>\n             <div>{{item.picName}}</div>\n           </div>\n           <div style=\"display:flex;\">\n             <div style=\"font-weight: bold;\">报警类型：</div>\n             <div>{{item.alarmType}}</div>\n           </div>\n        </div>\n      </div>\n    </div>\n    <!-- <record-detail ref=\"recordDetail\"></record-detail> -->\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport { Component, Vue, Watch } from 'vue-property-decorator';\nimport moment from 'moment';\nimport { EgpSvg } from 'egp-web-components';\nimport Card from '@/components/card/Main.vue';\nimport API from '@/api';\nimport { Params, Rule, originRule, Record } from '../../api/intrusion';\nimport { ElUpload } from 'element-ui/types/upload';\nimport axios from 'axios';\nimport uuid from 'uuid/v4';\nimport recordDetail from './RecordDetail.vue'\n\ninterface Point {\n  x: number;\n  y:number;\n}\n\n\n// http://192.168.3.109:7001/postImg\n@Component({\n  components: {\n    EgpSvg,\n    recordDetail,\n  }\n})\nexport default class IntrusionDetection extends Vue {\n  $refs!: {\n    upload: ElUpload;\n    egpSvg: any;\n    recordDetail:recordDetail;\n  }\n  private svgOptions: any = {};\n  private fileList: any[] = [];\n  private files: any[] = [];\n  private imgSrc = '';\n  private uploadLoding = false;\n  private detectionResult: any = {} \n  private resultImg = ''\n  private secondSelect = false;\n  private uploadBtn = 'success';\n  private intrusionStyle = true;\n  private resultList: any[] = [];\n  private loading = false;\n\n  private uploadData: {\n    confidence: number,\n    nms: number,\n    type: string,\n    region: string,\n  } = {\n    confidence: 0.8,\n    nms: 0.4,\n    type: 'attitude',\n    region: '',\n  };\n\n  mounted(){\n    if(this.uploadData && this.uploadData.hasOwnProperty('confidence'))  delete this.uploadData.confidence;\n    if(this.uploadData && this.uploadData.hasOwnProperty('nms'))  delete this.uploadData.nms;\n    if(this.uploadData && this.uploadData.hasOwnProperty('region'))  delete this.uploadData.region;\n  }\n  \n  private async submitUpload() {\n    console.log( this.$refs.upload)   \n    const {uploadFiles} = (this.$refs.upload as any);\n    if(!uploadFiles.length) {\n      this.$message({\n          message: '请选择文件后上传',\n          type: 'warning'\n      });\n      return;\n    }\n    const flie = [(this.$refs.upload as any).uploadFiles.pop()];\n    const data = (window as any).EcvAlarmData.data.find((item: any) =>{\n       return item.filename === flie[0].name\n    });\n    if(!data){\n      console.log('文件上传出错');\n      this.$message({\n        type:'error',\n        message:'文件上传出错'\n      })\n      return;\n    }\n\n    this.loading = true;\n     setTimeout(() => {\n      this.resultList = [data];\n      this.loading = false;\n    },3000)\n  }\n  \n  private originToCommon(rules: originRule[]): Rule[] {\n    return rules.map(item => ({ location: item.data, rule_id: item.id }));\n  }\n\n  private clearAll() {\n    this.fileList = [];\n    this.imgSrc = '';\n    if(this.$refs.egpSvg) this.$refs.egpSvg.setData([]);\n    this.resultList = [];\n  }\n  \n  private uploadChange(file: any, fileList: any) {\n    // const imgSrc = window.URL.createObjectURL(file.raw);\n    // this.imgSrc = imgSrc;\n  }\n  \n  private uploadSuccess(res: any, file: any, fileList: any) {\n    // this.uploadLoding = false;\n    // this.detectionResult = res;\n    // if(res.algType && res.algType !== 1){\n    //   console.log(res, '分析结果');\n    //   this.$message({message:\"分析错误\",\n    //     type: 'error'\n    //   })\n    //   return;\n    // }\n    // this.resultImg = res.img_base64? `data:image/png;base64, ${res.img_base64}` : '';\n    //强制刷新\n    // this.files = [];\n  }\n  \n  private uploadError(res: any, file: any, fileList: any){\n    // this.uploadLoding = false;\n    // console.log(res, 'uploadError');\n  }\n  \n  //清空数据\n  private clearData(){\n    // if(this.$refs.egpSvg) this.$refs.egpSvg.setData([]);\n  }\n //展示结果\n  private showResult(){\n    this.$nextTick(() => {\n      this.$refs.recordDetail.show(this.resultList);\n    })\n  }\n\n  private nativeUploadChange(e: any){\n    // this.secondSelect = false;\n    // this.$refs.egpSvg.setData([]);\n  }\n  \n\n  private selectChange(value: string) {\n    if(value === 'intrusion') {\n      this.intrusionStyle = false;\n      this.$nextTick(() => {\n        this.svgOptions = { type: 'polygon', name: value, color: 'red' };\n        this.uploadData = { confidence: 0.8, nms: 0.4, type: 'intrusion',region: '',};\n      })\n      console.log(this.uploadData, 'uploadData', this.svgOptions )\n    } else {\n      if(this.$refs.egpSvg) this.$refs.egpSvg.setData([]);\n      this.svgOptions = {};\n      this.intrusionStyle = true;\n      if(this.uploadData && this.uploadData.hasOwnProperty('confidence')) {\n        delete this.uploadData.confidence;\n      }\n      if(this.uploadData && this.uploadData.hasOwnProperty('nms')) {\n        delete this.uploadData.nms;\n      }\n      if(this.uploadData && this.uploadData.hasOwnProperty('region')) {\n        delete this.uploadData.region;\n      }\n    }\n  }\n\n  private clerarAll(){\n    (this.$refs.upload as any).uploadFiles = []\n  }\n\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.pic{\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: white;\n}\nh4{\n  text-align: right;\n}\n .avatar-uploader .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n  }\n  .avatar-uploader .el-upload:hover {\n    border-color: #409EFF;\n  }\n  .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 178px;\n    height: 178px;\n    line-height: 178px;\n    text-align: center;\n  }\n  .avatar {\n    width: 178px;\n    height: 178px;\n    display: block;\n  }\n\n</style>\n\n"]}]}